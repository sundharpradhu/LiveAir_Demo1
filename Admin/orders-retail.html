<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LiveAir - Retail Orders</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="bg-gray-100 flex h-screen">
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg flex flex-col">
    <div class="p-4 gradient-bg text-white font-bold text-xl">LiveAir</div>
    <nav class="flex-1 p-4 space-y-1">
      <a href="index.html" class="nav-link"><i data-lucide="home" class="w-5 h-5"></i><span>Home</span></a>
      <a href="clients.html" class="nav-link"><i data-lucide="users" class="w-5 h-5"></i><span>Clients</span></a>
      <details class="group" open>
        <summary class="nav-link"><i data-lucide="shopping-cart" class="w-5 h-5"></i><span>My Orders</span></summary>
        <div class="pl-8 py-1 space-y-1">
          <a href="orders-commercial.html" class="nav-link"><i data-lucide="store" class="w-5 h-5"></i><span>Commercial Orders</span></a>
          <a href="orders-retail.html" class="nav-link nav-active"><i data-lucide="shopping-bag" class="w-5 h-5"></i><span>Retail Orders</span></a>
        </div>
      </details>
      <a href="assets.html" class="nav-link"><i data-lucide="package" class="w-5 h-5"></i><span>My Products</span></a>
      <a href="tracking.html" class="nav-link"><i data-lucide="search" class="w-5 h-5"></i><span>Tracking</span></a>
      <a href="delivery.html" class="nav-link"><i data-lucide="truck" class="w-5 h-5"></i><span>Delivery</span></a>
      <a href="service-repair.html" class="nav-link"><i data-lucide="wrench" class="w-5 h-5"></i><span>Service & Repair</span></a>
      <a href="invoices.html" class="nav-link"><i data-lucide="file-text" class="w-5 h-5"></i><span>Invoices & Payments</span></a>
      <a href="alerts.html" class="nav-link"><i data-lucide="bell-ring" class="w-5 h-5"></i><span>Alerts</span></a>
    </nav>
    <div class="p-4 small">¬© 2025 LiveAir</div>
  </aside>

  <!-- Main -->
  <main class="flex-1 flex flex-col">
    <header class="bg-white shadow p-4 flex justify-between items-center">
      <h1 class="font-bold text-lg">Admin Dashboard</h1>
      <div class="flex items-center gap-3">
        <button title="Language" class="bg-gray-100 px-3 py-1 rounded">üåê EN</button>
        <button title="Notifications" class="bg-gray-100 p-2 rounded"><i data-lucide="bell" class="w-5 h-5"></i></button>
        <div title="Profile" class="bg-blue-600 w-8 h-8 rounded-full text-white grid place-items-center">A</div>
      </div>
    </header>

    <section class="p-6 overflow-y-auto flex-1">
      <h2 class="text-xl font-bold mb-4">Retail Orders</h2>
      <table class="w-full bg-white rounded shadow overflow-hidden">
        <thead>
          <tr class="bg-gray-100 text-left">
            <th class="p-2">Order ID</th>
            <th class="p-2">Customer</th>
            <th class="p-2">Status</th>
            <th class="p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="orderTableBody">
          <tr class="border-t">
            <td class="p-2 text-blue-600 cursor-pointer order-link" data-id="R-2001">R-2001</td>
            <td class="p-2">Murugan</td>
            <td class="p-2 status-cell"></td>
            <td class="p-2 actions-cell"></td>
          </tr>
          <tr class="border-t">
            <td class="p-2 text-blue-600 cursor-pointer order-link" data-id="R-2002">R-2002</td>
            <td class="p-2">Ganesh</td>
            <td class="p-2 status-cell"></td>
            <td class="p-2 actions-cell"></td>
          </tr>
          <tr class="border-t">
            <td class="p-2 text-blue-600 cursor-pointer order-link" data-id="R-2003">R-2003</td>
            <td class="p-2">Shiva</td>
            <td class="p-2 status-cell"></td>
            <td class="p-2 actions-cell"></td>
          </tr>
          <tr class="border-t">
            <td class="p-2 text-blue-600 cursor-pointer order-link" data-id="R-2004">R-2004</td>
            <td class="p-2">Balaji</td>
            <td class="p-2 status-cell"></td>
            <td class="p-2 actions-cell"></td>
          </tr>
          <tr class="border-t">
            <td class="p-2 text-blue-600 cursor-pointer order-link" data-id="R-2005">R-2005</td>
            <td class="p-2">Velan</td>
            <td class="p-2 status-cell"></td>
            <td class="p-2 actions-cell"></td>
          </tr>
        </tbody>
      </table>
    </section>
  </main>

  <!-- Tracking Modal -->
  <div id="trackingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg shadow-lg w-[520px] max-h-[90vh] overflow-y-auto">
      <div class="p-4 border-b flex justify-between items-center">
        <h3 id="trackingTitle" class="font-bold text-lg">Tracking</h3>
        <button onclick="closeTrackingModal()" class="text-gray-600 hover:text-black">‚úï</button>
      </div>
      <div id="trackingSteps" class="p-5"></div>
    </div>
  </div>

  <script>
    lucide.createIcons();

    const STEPS = [
      { label: 'Placed',        status: {text:'Ordered',          cls:'bg-blue-100 text-blue-700'} },
      { label: 'In Progress',   status: {text:'Pending',          cls:'bg-yellow-100 text-yellow-800'} },
      { label: 'Ready To Dispatch', status: {text:'Pending',     cls:'bg-yellow-100 text-yellow-800'} },
      { label: 'Dispatch',      status: {text:'On the Way',       cls:'bg-indigo-100 text-indigo-700'} },
      { label: 'On the Way',    status: {text:'Out for Delivery', cls:'bg-purple-100 text-purple-700'} },
      { label: 'Delivered',     status: {text:'Delivered',        cls:'bg-green-100 text-green-700'} },
      { label: 'Paid',          status: {text:'Paid',             cls:'bg-emerald-100 text-emerald-700'} },
      { label: 'Replace',       status: {text:'Return/Replace',   cls:'bg-red-100 text-red-700'} }
    ];

    const orderProgress = {};

    function buildDropdown(selectedIndex = 0) {
      return `<select class="border p-2 rounded status-select">
        ${STEPS.map((s, i) => `<option value="${i}" ${i===selectedIndex?'selected':''}>${s.label}</option>`).join('')}
      </select>`;
    }

    function setStatusBadge(cell, stepIndex) {
      const s = STEPS[stepIndex].status;
      cell.innerHTML = `<span class="px-2 py-1 rounded text-xs ${s.cls}">${s.text}</span>`;
    }

    function renderStepper(currentIndex) {
      return STEPS.map((step, i) => {
        const isDone = i < currentIndex;
        const isCurrent = i === currentIndex;
        const showConnector = i < STEPS.length - 1;

        const dot = isDone ? 'bg-blue-600 border-blue-600'
          : (isCurrent ? 'bg-white border-blue-600' : 'bg-white border-gray-300');

        const connector = showConnector
          ? (i < currentIndex ? 'border-blue-600' : 'border-gray-300 border-dashed')
          : 'border-transparent';

        return `
          <div class="relative pl-10">
            <div class="absolute left-[13px] top-5 ${showConnector ? 'bottom-0' : ''} border-l-2 ${connector}"></div>
            <div class="absolute left-2 top-2 w-4 h-4 rounded-full border-2 ${dot}"></div>
            <div class="pb-5">
              <div class="text-sm font-medium ${isDone || isCurrent ? 'text-gray-900' : 'text-gray-500'}">${step.label}</div>
              ${isCurrent ? `<div class="text-xs mt-1 inline-block px-2 py-0.5 rounded ${step.status.cls}">${step.status.text}</div>` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function openTrackingModal(orderId, currentIndex) {
      document.getElementById('trackingTitle').textContent = `Tracking Log: ${orderId}`;
      document.getElementById('trackingSteps').innerHTML = renderStepper(currentIndex);
      const modal = document.getElementById('trackingModal');
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    }

    function closeTrackingModal() {
      const modal = document.getElementById('trackingModal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    }

    document.querySelectorAll('#orderTableBody tr').forEach(row => {
      const orderId = row.querySelector('.order-link').dataset.id;
      const statusCell = row.querySelector('.status-cell');
      const actionsCell = row.querySelector('.actions-cell');

      const current = orderProgress[orderId] ?? 0;
      actionsCell.innerHTML = buildDropdown(current);
      setStatusBadge(statusCell, current);

      actionsCell.querySelector('.status-select').addEventListener('change', (e) => {
        const idx = parseInt(e.target.value, 10);
        orderProgress[orderId] = idx;
        setStatusBadge(statusCell, idx);
      });

      row.querySelector('.order-link').addEventListener('click', () => {
        const idx = orderProgress[orderId] ?? 0;
        openTrackingModal(orderId, idx);
      });
    });
  </script>
  <!-- Lucide Icons -->
  <script>lucide.createIcons();</script>
</body>
</html>
