<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>LiveAir - Delivery Assignment</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    
    .nav-link {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      color: #374151;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.2s;
      gap: 12px;
      cursor: pointer;
    }
    
    .nav-link:hover {
      background-color: #f3f4f6;
      color: #1f2937;
    }
    
    .nav-active {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white !important;
    }
    
    .small {
      font-size: 0.875rem;
      color: #6b7280;
    }
    
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
      backdrop-filter: blur(2px);
    }
    
    .modal-overlay.active {
      display: flex;
    }
    
    .success-banner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #d1fae5;
      border: 1px solid #34d399;
      color: #065f46;
      padding: 12px 24px;
      border-radius: 8px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      z-index: 100;
      display: none;
    }
    
    .success-banner.show {
      display: block;
      animation: slideDown 0.3s ease-out;
    }
    
    @keyframes slideDown {
      from {
        transform: translateX(-50%) translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateX(-50%) translateY(0);
        opacity: 1;
      }
    }
    
    .priority-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .priority-high {
      background: #fecaca;
      color: #991b1b;
    }
    
    .priority-medium {
      background: #fef3c7;
      color: #92400e;
    }
    
    .priority-low {
      background: #d1fae5;
      color: #065f46;
    }
    
    .assign-btn {
      transition: all 0.2s;
    }
    
    .assign-btn:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }
    
    .assign-btn:disabled {
      cursor: not-allowed;
      opacity: 0.7;
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .modal-header {
      border-bottom: 1px solid #e5e7eb;
      padding: 1.5rem;
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      border-top: 1px solid #e5e7eb;
      padding: 1.5rem;
      display: flex;
      justify-content: flex-end;
      gap: 0.75rem;
    }
  </style>
</head>
<body class="bg-gray-100 flex h-screen">
  
  <!-- Success Banner -->
  <div id="successBanner" class="success-banner">
    <i data-lucide="check-circle" class="w-5 h-5 inline mr-2"></i>
    <span id="bannerMessage">Action completed successfully!</span>
  </div>
  
  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-lg flex flex-col">
    <div class="p-4 gradient-bg text-white font-bold text-xl">LiveAir</div>
    <nav class="flex-1 p-4 space-y-1">
      <a href="index.html" class="nav-link">
        <i data-lucide="home" class="w-5 h-5"></i>
        <span>Home</span>
      </a>
      <a href="clients.html" class="nav-link">
        <i data-lucide="users" class="w-5 h-5"></i>
        <span>Clients</span>
      </a>
      <details class="group" open>
        <summary class="nav-link">
          <i data-lucide="shopping-cart" class="w-5 h-5"></i>
          <span>My Orders</span>
        </summary>
        <div class="pl-8 py-1 space-y-1">
          <a href="orders-commercial.html" class="nav-link">
            <i data-lucide="store" class="w-5 h-5"></i>
            <span>Commercial Orders</span>
          </a>
          <a href="orders-retail.html" class="nav-link">
            <i data-lucide="shopping-bag" class="w-5 h-5"></i>
            <span>Retail Orders</span>
          </a>
        </div>
      </details>
      <a href="assets.html" class="nav-link">
        <i data-lucide="package" class="w-5 h-5"></i>
        <span>My Products</span>
      </a>
      <a href="tracking.html" class="nav-link">
        <i data-lucide="search" class="w-5 h-5"></i>
        <span>Tracking</span>
      </a>
      <a href="delivery.html" class="nav-link nav-active">
        <i data-lucide="truck" class="w-5 h-5"></i>
        <span>Delivery Assignment</span>
      </a>
      <a href="service-repair.html" class="nav-link">
        <i data-lucide="wrench" class="w-5 h-5"></i>
        <span>Service & Repair</span>
      </a>
      <a href="invoices.html" class="nav-link">
        <i data-lucide="file-text" class="w-5 h-5"></i>
        <span>Invoices & Payments</span>
      </a>
      <a href="alerts.html" class="nav-link">
        <i data-lucide="bell-ring" class="w-5 h-5"></i>
        <span>Alerts</span>
      </a>
    </nav>
    <div class="p-4 small">Â© 2025 LiveAir</div>
  </aside>
    
  <!-- Main Content -->
  <main class="flex-1 flex flex-col">
    
    <!-- Header -->
    <header class="bg-white shadow p-4 flex justify-between items-center">
      <h1 class="font-bold text-lg">Delivery Assignment Dashboard</h1>
      <div class="flex items-center gap-3">
        <button title="Language" class="bg-gray-100 px-3 py-1 rounded hover:bg-gray-200 transition-colors">
          <i data-lucide="globe" class="w-4 h-4 inline mr-1"></i>
          EN
        </button>
        <button title="Notifications" class="bg-gray-100 p-2 rounded hover:bg-gray-200 transition-colors">
          <i data-lucide="bell" class="w-5 h-5"></i>
        </button>
        <div title="Profile" class="bg-blue-600 w-8 h-8 rounded-full text-white grid place-items-center font-semibold">
          A
        </div>
      </div>
    </header>

    <!-- Main Content Section -->
    <section class="p-6 overflow-y-auto flex-1">
      
      <!-- Page Header -->
      <div class="flex justify-between items-center mb-6">
        <div>
          <h2 class="text-2xl font-bold text-gray-800">Delivery Assignment</h2>
          <p class="text-gray-600 mt-1">Manage and assign delivery personnel to orders</p>
        </div>
        
        <div class="flex gap-3">
          <button id="assignSelectedBtn" 
                  class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors hidden">
            <i data-lucide="users" class="w-4 h-4 inline mr-2"></i>
            Assign Selected
          </button>
          <button id="addDeliveryBoyBtn" 
                  class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm">
            <i data-lucide="user-plus" class="w-4 h-4 inline mr-2"></i>
            Add Delivery Boy
          </button>
        </div>
      </div>

      <!-- Status Summary -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
        <div class="bg-white p-4 rounded-lg shadow-sm border">
          <div class="flex items-center">
            <div class="p-2 bg-blue-100 rounded-lg mr-3">
              <i data-lucide="package" class="w-5 h-5 text-blue-600"></i>
            </div>
            <div>
              <p class="text-sm text-gray-600">Total Orders</p>
              <p class="text-2xl font-bold text-gray-800" id="totalOrders">3</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow-sm border">
          <div class="flex items-center">
            <div class="p-2 bg-orange-100 rounded-lg mr-3">
              <i data-lucide="clock" class="w-5 h-5 text-orange-600"></i>
            </div>
            <div>
              <p class="text-sm text-gray-600">Pending Assignment</p>
              <p class="text-2xl font-bold text-gray-800" id="pendingCount">3</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow-sm border">
          <div class="flex items-center">
            <div class="p-2 bg-green-100 rounded-lg mr-3">
              <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
            </div>
            <div>
              <p class="text-sm text-gray-600">Assigned</p>
              <p class="text-2xl font-bold text-gray-800" id="assignedCount">0</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white p-4 rounded-lg shadow-sm border">
          <div class="flex items-center">
            <div class="p-2 bg-purple-100 rounded-lg mr-3">
              <i data-lucide="users" class="w-5 h-5 text-purple-600"></i>
            </div>
            <div>
              <p class="text-sm text-gray-600">Delivery Boys</p>
              <p class="text-2xl font-bold text-gray-800" id="deliveryBoysCount">5</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Pending Orders Message -->
      <div class="mb-4">
        <p id="pendingMsg" class="text-gray-600 flex items-center">
          <i data-lucide="clock" class="w-4 h-4 mr-2 text-orange-600"></i>
          <span><strong>3</strong> orders pending assignment for delivery.</span>
        </p>
      </div>

      <!-- Orders Table -->
      <div class="bg-white rounded-lg shadow-sm border overflow-hidden">
        <div class="overflow-x-auto">
          <table class="w-full">
            <thead class="bg-gray-50 border-b">
              <tr>
                <th class="p-4 text-left">
                  <input type="checkbox" id="selectAll" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                </th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Order ID</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Client Name</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Location</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Delivery Date</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Priority</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Assigned To</th>
                <th class="p-4 text-left text-sm font-medium text-gray-700">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              <tr class="hover:bg-gray-50">
                <td class="p-4">
                  <input type="checkbox" class="row-select rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">C-1001</div>
                  <div class="text-sm text-gray-500">Commercial Order</div>
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">Acme Corp</div>
                  <div class="text-sm text-gray-500">John Doe</div>
                </td>
                <td class="p-4">
                  <div class="text-gray-900">Chennai</div>
                  <div class="text-sm text-gray-500">Tamil Nadu</div>
                </td>
                <td class="p-4 delivery-date text-gray-500">-</td>
                <td class="p-4 priority-cell">-</td>
                <td class="p-4">
                  <select class="assigned-to border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                    <option value="ravi">Ravi (DLV-12)</option>
                    <option value="ashok">Ashok (DLV-13)</option>
                    <option value="gowtham">Gowtham (DLV-14)</option>
                    <option value="manoj">Manoj (DLV-15)</option>
                    <option value="karthik">Karthik (DLV-16)</option>
                  </select>
                </td>
                <td class="p-4">
                  <button class="assign-btn px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
                    Assign
                  </button>
                </td>
              </tr>
              
              <tr class="hover:bg-gray-50">
                <td class="p-4">
                  <input type="checkbox" class="row-select rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">C-1002</div>
                  <div class="text-sm text-gray-500">Retail Order</div>
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">Priya Industries</div>
                  <div class="text-sm text-gray-500">Priya Sharma</div>
                </td>
                <td class="p-4">
                  <div class="text-gray-900">Coimbatore</div>
                  <div class="text-sm text-gray-500">Tamil Nadu</div>
                </td>
                <td class="p-4 delivery-date text-gray-500">-</td>
                <td class="p-4 priority-cell">-</td>
                <td class="p-4">
                  <select class="assigned-to border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                    <option value="ashok">Ashok (DLV-13)</option>
                    <option value="ravi">Ravi (DLV-12)</option>
                    <option value="gowtham">Gowtham (DLV-14)</option>
                    <option value="manoj">Manoj (DLV-15)</option>
                    <option value="karthik">Karthik (DLV-16)</option>
                  </select>
                </td>
                <td class="p-4">
                  <button class="assign-btn px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
                    Assign
                  </button>
                </td>
              </tr>
              
              <tr class="hover:bg-gray-50">
                <td class="p-4">
                  <input type="checkbox" class="row-select rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">C-1003</div>
                  <div class="text-sm text-gray-500">Commercial Order</div>
                </td>
                <td class="p-4">
                  <div class="font-medium text-gray-900">Senthil Trading</div>
                  <div class="text-sm text-gray-500">Senthil Kumar</div>
                </td>
                <td class="p-4">
                  <div class="text-gray-900">Madurai</div>
                  <div class="text-sm text-gray-500">Tamil Nadu</div>
                </td>
                <td class="p-4 delivery-date text-gray-500">-</td>
                <td class="p-4 priority-cell">-</td>
                <td class="p-4">
                  <select class="assigned-to border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-2 focus:ring-blue-500">
                    <option value="gowtham">Gowtham (DLV-14)</option>
                    <option value="ravi">Ravi (DLV-12)</option>
                    <option value="ashok">Ashok (DLV-13)</option>
                    <option value="manoj">Manoj (DLV-15)</option>
                    <option value="karthik">Karthik (DLV-16)</option>
                  </select>
                </td>
                <td class="p-4">
                  <button class="assign-btn px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm font-medium">
                    Assign
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- No Pending Orders Message -->
      <div id="noPendingCard" class="mt-6 p-8 bg-gray-50 border rounded-lg text-center hidden">
        <i data-lucide="check-circle" class="w-12 h-12 text-green-500 mx-auto mb-3"></i>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">All Orders Assigned</h3>
        <p class="text-gray-600">No pending deliveries for today. Great work!</p>
      </div>
    </section>
  </main>

  <!-- Add Delivery Boy Modal -->
  <div id="deliveryBoyModal" class="modal-overlay">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
      <div class="modal-header">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800 flex items-center">
            <i data-lucide="user-plus" class="w-5 h-5 mr-2 text-blue-600"></i>
            Add Delivery Boy
          </h3>
          <button id="closeDeliveryBoyModal" class="text-gray-400 hover:text-gray-600">
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
      </div>
      
      <div class="modal-body">
        <form id="deliveryBoyForm" class="space-y-4">
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
            <input type="text" name="fullName" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   placeholder="Enter full name">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number *</label>
            <input type="tel" name="phoneNumber" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   placeholder="+91 9876543210">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Number *</label>
            <input type="text" name="vehicleNumber" required 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                   placeholder="TN 01 AB 1234">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Vehicle Type</label>
            <select name="vehicleType" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="bike">Bike</option>
              <option value="car">Car</option>
              <option value="van">Van</option>
              <option value="truck">Truck</option>
            </select>
          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" id="cancelDeliveryBoy" 
                class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
          Cancel
        </button>
        <button type="button" id="saveDeliveryBoy" 
                class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
          <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
          Save
        </button>
      </div>
    </div>
  </div>

  <!-- Assignment Modal -->
  <div id="assignModal" class="modal-overlay">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md mx-4">
      <div class="modal-header">
        <div class="flex items-center justify-between">
          <h3 class="text-lg font-semibold text-gray-800 flex items-center">
            <i data-lucide="calendar" class="w-5 h-5 mr-2 text-blue-600"></i>
            Assign Delivery
          </h3>
          <button id="closeAssignModal" class="text-gray-400 hover:text-gray-600">
            <i data-lucide="x" class="w-6 h-6"></i>
          </button>
        </div>
      </div>
      
      <div class="modal-body">
        <form id="assignmentForm" class="space-y-4">
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
            <input type="date" id="startDate" 
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Delivery Date *</label>
            <input type="date" id="endDate" required
                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          
          <div class="form-group">
            <label class="block text-sm font-medium text-gray-700 mb-2">Priority *</label>
            <select id="priority" required 
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="">Select Priority</option>
              <option value="High">High Priority</option>
              <option value="Medium">Medium Priority</option>
              <option value="Low">Low Priority</option>
            </select>
          </div>
        </form>
      </div>
      
      <div class="modal-footer">
        <button type="button" id="cancelAssignment" 
                class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors">
          Cancel
        </button>
        <button type="button" id="saveAssign" 
                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          <i data-lucide="check" class="w-4 h-4 inline mr-2"></i>
          Save Assignment
        </button>
      </div>
    </div>
  </div>

  <script>
    // Initialize Lucide icons
    lucide.createIcons();

    // Global variables
    let selectedRows = [];
    let deliveryBoyCounter = 17; // Start from DLV-17

    // DOM Elements
    const assignModal = document.getElementById("assignModal");
    const deliveryBoyModal = document.getElementById("deliveryBoyModal");
    const assignSelectedBtn = document.getElementById("assignSelectedBtn");
    const addDeliveryBoyBtn = document.getElementById("addDeliveryBoyBtn");
    const checkboxes = document.querySelectorAll(".row-select");
    const selectAll = document.getElementById("selectAll");

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Page loaded, initializing...');
      updatePendingMessage();
      updateStatistics();
      initializeEventListeners();
      lucide.createIcons();
    });

    // Initialize all event listeners
    function initializeEventListeners() {
      // Add Delivery Boy Modal
      addDeliveryBoyBtn.addEventListener('click', openDeliveryBoyModal);
      document.getElementById('closeDeliveryBoyModal').addEventListener('click', closeDeliveryBoyModal);
      document.getElementById('cancelDeliveryBoy').addEventListener('click', closeDeliveryBoyModal);
      document.getElementById('saveDeliveryBoy').addEventListener('click', handleDeliveryBoySubmit);

      // Assignment Modal
      document.getElementById('closeAssignModal').addEventListener('click', closeAssignModal);
      document.getElementById('cancelAssignment').addEventListener('click', closeAssignModal);
      document.getElementById('saveAssign').addEventListener('click', handleAssignmentSubmit);

      // Bulk assign functionality
      assignSelectedBtn.addEventListener("click", function() {
        const checkedBoxes = document.querySelectorAll(".row-select:checked");
        selectedRows = Array.from(checkedBoxes).map(cb => cb.closest("tr"));
        
        if (selectedRows.length === 0) {
          showSuccessBanner('No orders selected', 'error');
          return;
        }
        
        setDefaultDates();
        openAssignModal();
      });

      // Individual assign buttons
      document.querySelectorAll(".assign-btn").forEach(btn => {
        btn.addEventListener("click", function() {
          const row = this.closest("tr");
          selectedRows = [row];
          
          setDefaultDates();
          openAssignModal();
        });
      });}

      // Select all functionality
      selectAll.addEventListener("change", handleSelectAll);

      // Individual checkbox handling
      checkboxes.forEach(cb => {
        cb.addEventListener("change", handleCheckboxChange);
      });

      // Close modals when clicking outside
      document.addEventListener('click', function(e) {
        if (e.target === assignModal) {
          closeAssignModal();
        }
        if (e.target === deliveryBoyModal) {
          closeDeliveryBoyModal();
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', function(e) {
          if (e.key === 'Escape') {
            if (assignModal.classList.contains('active')) {
              closeAssignModal();
            }
          }
        });

        // Prevent default drag behaviors on the entire page
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            document.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }
    </script>
<!-- Lucide Icons -->
  <script>lucide.createIcons();</script>
</body>
</html>